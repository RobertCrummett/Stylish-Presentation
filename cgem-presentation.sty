%% CGEM Presentation Package
\ProvidesPackage{cgem-presentation}

%----------------------------------------
%% CGEM Presentation Package Dependencies
% Preamble
\usepackage{amsmath, amsfonts, amssymb} % Math
\usepackage[backend=biber, style=alphabetic]{biblatex} % Bibliogrpahy, change style if you prefer
\usepackage{fontspec} % Fonts --- If this fails to compile, use XeLaTeX or LuaTeX
\usepackage{graphicx} % Figures
\usepackage{hyperref} % Links
\usepackage[absolute,overlay]{textpos} % Figure placement
\usepackage{xcolor} % Colors

% Linking Lua scripts
\directlua{bib = require("Lua.bib")} % bibliography
\directlua{title = require("Lua.title")} % presentation title
\directlua{authors = require("Lua.authors")} % presentation authors
\directlua{affiliations = require("Lua.affiliations")} % affiliations - CGEM, CSM, GMRC, etc
\directlua{meetingInfo = require("Lua.meetingInfo") } % meeting, conference, session, date, etc
\directlua{contact = require("Lua.contact") } % presentation title

%-----------------------------------------
%% Global TeX Settings
% CGEM light blue color
\definecolor{highlight}{HTML}{FFC000}
\definecolor{cgemblue}{HTML}{90C5FB} % Light CGEM blue

% Font Settings
\setsansfont{Arial}

% Hyperlink settings
\hypersetup{
  colorlinks=true,
  citecolor=cgemblue,
  linkcolor=cgemblue,
  urlcolor=magenta,
} % Link to corresponding author

% Background and default text color
\setbeamercolor{background canvas}{bg = black}
\setbeamercolor{normal text}{fg = white}\usebeamercolor*{normal text}

% Turn off Beamer navigation buttons
\setbeamertemplate{navigation symbols}{}

% Page numbering
\setbeamertemplate{footline}
{
  \begin{flushright}
    \textcolor{cgemblue}{\large \insertframenumber}
    \hspace{1mm}
    \vspace{-1mm}
  \end{flushright}
}

%------------------------------------------
%% Title page 

% Title
\renewcommand{\title}[1]{ \directlua{ title.set("title", "#1") } }

% Slide authors
\renewcommand{\author}[1]{
  \directlua{ authors.set("title", "#1") }
  \directlua{ authors.set("question", "#1") }
}

% Affiliations line
\newcommand{\affiliations}[2]
{
  \directlua{ affiliations.set("title", "#1") }
  \directlua{ affiliations.set("question", "#2") }
}

% Meeting information, date, session #, etc
\newcommand{\meeting}[1]{\directlua{ meetingInfo.set("title", "#1") } }

% Autho contact information
\newcommand{\contactInfo}[1]{ \directlua{ contact.set("#1") } }

% Create new title, arguments control spacing of different sections on frame
% if you desire th change text size, color, linespacing etc, you will need to
% track them down in the Lua directory!
\renewcommand{\maketitle}[4]
{
  \begin{center}
    \directlua{ title.print("title") } \\ [#1]
    \directlua{ authors.print("title") } \\ [#2]
    \directlua{ affiliations.print("title") } \\ [#3]
    \directlua{ meetingInfo.print("title") } \\ [#4]
  \end{center}
}

%------------------------------------------
%% Enumeration / Itemize  / List Settings, ie, Bullet Point Lists

% Base level
\setbeamertemplate{enumerate item}{\LARGE \color{cgemblue} \textbullet}
\setbeamerfont*{itemize/enumerate body}{size=\LARGE}
\setbeamercolor{itemize/enumerate body}{fg=cgemblue}

% First Level
\setbeamertemplate{enumerate subitem}{\Large \color{white} --}
\setbeamerfont*{itemize/enumerate subbody}{size=\Large}
\setbeamercolor{itemize/enumerate subbody}{fg=white}

% Second Level -- only use in emergencies!!
\setbeamertemplate{enumerate subsubitem}{\large \color{cgemblue} \textbullet}
\setbeamerfont*{itemize/enumerate subsubbody}{size=\large}
\setbeamercolor{itemize/enumerate subsubbody}{fg=cgemblue}

%------------------------------------------
%% Frame title format

% Frame titles centers, Huge and white by default
\setbeamertemplate{frametitle}[default][center]
\setbeamerfont*{frametitle}{size=\Huge}
\setbeamercolor{frametitle}{fg=white}

%------------------------------------------
%% Question Slide

% Print a horizontal while bar across the text width of frame
\newcommand{\whitebar}{ \color{white} \noindent \makebox[\linewidth]{\rule{\textwidth}{0.7pt}} }

\newcommand{\makequestion}[5]
{
  \begin{center}
    \vspace{#1} 
    \directlua{ affiliations.print("question") } \\ [#2]
    \whitebar \\ [#3]
    \color{cgemblue}
    \LARGE
    Thank You \\
    Questions? \\ [#4]
    \whitebar \\ [#5]
    \directlua{ authors.print("question") }
  \end{center}
}

%-------------------------------------------
%% Bibliography Style

% Linking bibliography folder
\newcommand{\setbibliographypath}[1]{ \directlua{ bib.make("#1") } }

% Biblography colors
\setbeamercolor*{bibliography entry title}{fg=white}
\setbeamercolor*{bibliography entry location}{fg=white}
\setbeamercolor*{bibliography entry note}{fg=white}
\setbeamercolor*{bibliography entry author}{fg=white}
\setbeamercolor*{bibliography item}{fg=cgemblue}

% No numbering on continued reference slides
\setbeamertemplate{frametitle continuation}{}

%--------------------------------------------
%% Citaions

% Figure citation beneath bottom right hand corner of image, integrates with BibTeX
\newcommand{\citefig}[1]
{
  \begin{flushright}
    \vspace{-4mm}
    \cite{#1}
  \end{flushright}
}
